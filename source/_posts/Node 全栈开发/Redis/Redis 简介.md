---
title: Redis 简介
categories:
  - Node 全栈开发
  - Redis
tags:
  - Redis
abbrlink: b507edcd
date: 2023-01-09 09:04:58
---

## 什么是 Redis
1. Redis 是一个使用 ANSI C 编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库；
2. Redis 不是简单的 Key-Value 数据库，它还支持数据结构，例如：
    - 字符串；
    - 哈希；
    - 列表；
    - 集合；
    - 带范围查询的排序集合；
    - 位图；
    - 超日志；
    - 带有半径查询和流的地理空间索引；
3. Redis 具有内置的复制功能，解析执行 Lua 脚本，LRU 缓存控制，事务和不同级别的磁盘持久性，并通过 Redis Sentinel 和 Redis Cluster 自动分区提供高可用性；

## Redis 的存储结构
1. 在大多数编程语言中都有一种数据结构：字典，例如代码 dict["key"] = "value" 中：
    - dict 是一个字典结构变量；
    - key 是键名；
    - value 是键值；
2. 在字典中可以获取或设置键名对应的键值，也可以删除一个键；
3. Redis 是 REmote DIctionary Server（远程字典服务器）的缩写，它以字典结构存储数据，并允许其他应用通过 TCP 协议读写字典中的内容；
4. Redis 字典中的键值除了可以是字符串，还可以是其它数据类型，其中比较常见的有：
    |类型|	说明|
    |---|-----|
    |String	|字符串|
    |Hash	|散列，是由与值相关联的字段组成的内容，字段和值都是字符串；类似于 JavaScript 中的对象结构；|
    |List	|列表，根据插入顺序排序的字符串元素的集合，它们基本上是链表；|
    |Set	|未排序的字符串元素集合，集合中的数据是不重复的；|
    |ZSet	|与 Sets 类似，但每个字符串元素都与一个称为分数的浮点值相关联，元素总是按它们的分数排序，因此与 Sets 不同，可以检索一系列元素（例如，获取前 10 名或后 10 名的数据）|


## 内存存储与持久化
1. Redis 数据库中所有数据都存储在内存中，相对于磁盘，内存的数据 读/写 速度要快得多，所以通常用 Redis 做缓存数据库，在一台普通电脑上，Redis 可以在一秒内读写超过 10 万个键值；
2. Redis 官网的性能测试显示，在 Linux 2.6、Xeon X3320 2.5 GHz 服务器上，50 个并发的情况下请求 100000 次，SET 操作可达 110000 次 / s，GET 操作可达 81000 次 / s；
3. 将数据存储在内存中也有问题，比如程序退出后内存中的数据会丢失，不过 Redis 提供了对持久化的支持，即可以将内存中的数据异步写入到硬盘中，同时不影响继续提供服务；


## Redis 中的多数据库
1. 一个 Redis 实例提供了多个用来存储数据的字典，客户端可以指定将数据存储在哪个字典中；
    - 这与在一个关系数据库中可以创建多个数据库类似，所有可以将其中的每个字典都理解成一个独立的数据库；
    - Redis 默认支持 16 个数据库，分别编号为 0、1、2、...14、15；Redis 不支持自定义数据库名字；每个数据库都以编号命名，开发者必须要明确哪个数据库存放了哪些数据；可以通过配置参数 databases 修改支持的数据库个数；
    - 客户端与 Redis 建立连接后自动选择 0 号数据库，可以使用 SELECT 命令来更换数据库：
2. 每个数据库都是独立的，也就是说在 0 号数据库中插入的数据在 1 号数据库是访问不到的；
    - 最重要的一点是多个数据库之间并不是完全隔离的，比如 FLUSHALL 命令可以清空一个 Redis 实例中所有数据库中的数据；
    - 综上所述，这些数据库更像是一个命名空间，而不适宜存储不同应用程序的数据，比如不适宜使用 0 号数据库存储 A 应用数据，使用 1 号数据库存储 B 应用数据，这是非常不推荐的做法！！！
    - 不同的应用应该使用不同的 Redis 实例存储数据，由于 Redis 非常轻量级，一个空的 Redis 占用的内存只有 1MB 左右，所以不用担心多个 Redis 实例会额外占用很多内存；

## 功能丰富
1. 作为缓存系统：
    - Redis 可以为每个键设置生存时间，生存时间到期后会自动被删除；
    - 这一功能配合出色的性能让 Redis 可以作为缓存来使用；
    - 作为缓存系统，Redis 还可以限定数据占用的最大空间，在数据达到空间限制后可以按照一定的规则自动淘汰不需要的键；
2. 作为队列系统：除此之外，Redis 的列表类型键可以用来实现队列，并且支持阻塞式读取，可以很容易的实现一个高性能的优先级队列；
3. “发布/订阅”功能：同时在更高层面上，Redis 还支持“发布/订阅”的消息模式，可以基于此构建聊天室等系统；


## Redis 应用场景
1. 一个产品的使用场景肯定是需要根据产品的特性，先列举一下 Redis 的特点：
    - 读写性能优异；
    - 持久化；
    - 数据类型丰富；
    - 单线程；
    - 数据自动过期；
    - 发布订阅；
    - 分布式；
2. 这里通过几个场景，不同维度说下 Redis 的应用：
    - 缓存系统：缓存现在几乎是所有中大型网站都在用的必杀技，合理的利用缓存不仅能够提升网站访问速度，还能大大降低数据库的压力，Redis 提供了键过期功能，也提供了灵活的键淘汰策略，所以，现在 Redis 用在缓存的场合非常多；
    - 排行榜：很多网站都有排行榜应用的，如京东的月度销量榜单、商品按时间的上新排行榜等，Redis 提供的有序集合数据类构能实现各种复杂的排行榜应用；
    - 计数器：什么是计数器，如电商网站商品的浏览量、视频网站视频的播放数等，为了保证数据实时效，每次浏览都得给 +1，并发量高时如果每次都请求数据库操作无疑是种挑战和压力，Redis 提供的 incr 命令来实现计数器功能，内存操作，性能非常好，非常适用于这些计数场景；
    - 分布式会话：集群模式下，在应用不多的情况下一般使用容器自带的 session 复制功能就能满足，当应用增多相对复杂的系统中，一般都会搭建以 Redis 等内存数据库为中心的 session 服务，session 不再由容器管理，而是由 session 服务及内存数据库管理；
    - 分布式锁：在很多互联网公司中都使用了分布式技术，分布式技术带来的技术挑战是对同一个资源的并发访问，如全局ID、减库存、秒杀等场景，并发量不大的场景可以使用数据库的悲观锁、乐观锁来实现，但在并发量高的场合中，利用数据库锁来控制资源的并发访问是不太理想的，大大影响了数据库的性能，可以利用Redis 的 setnx 功能来编写分布式的锁，如果设置返回 1 说明获取锁成功，否则获取锁失败，实际应用中要考虑的细节要更多；
    - 社交网络：点赞、踩、关注/被关注、共同好友等是社交网站的基本功能，社交网站的访问量通常来说比较大，而且传统的关系数据库类型不适合存储这种类型的数据，Redis 提供的哈希、集合等数据结构能很方便的的实现这些功能；
    - 最新列表：Redis 列表结构，LPUSH 可以在列表头部插入一个内容 ID 作为关键字，LTRIM 可用来限制列表的数量，这样列表永远为 N 个 ID，无需查询最新的列表，直接根据 ID 去到对应的内容页即可；
    - 消息系统：消息队列是大型网站必用中间件，如 ActiveMQ、RabbitMQ、Kafka 等流行的消息队列中间件，主要用于业务解耦、流量削峰及异步处理实时性低的业务，Redis 提供了发布/订阅 及阻塞队列功能，能实现一个简单的消息队列系统，另外这个不能和专业的消息中间件相比；

